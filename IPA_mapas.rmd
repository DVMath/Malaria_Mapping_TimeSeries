---
title: "Cálculo IPA e mapas SIVEP 2003-2018"
author: "Raquel Lana e Daniel Vilella"
date: "June 22, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Visualização do IPA por município por ano

Conceito de IPA: 

## Bibliotecas
```{r}
require(maptools, quietly = TRUE, warn.conflicts = FALSE)
library('maptools')
library(rgdal)
library('stringr')
library('data.table')

```

## Importanto os bancos de casos de malária
```{r setup, include=FALSE}
d03 <- read.csv("Dados/CasosMunicip/vivax03_muni.csv")
#head(d03)

d04 <- read.csv("Dados/CasosMunicip/vivax04_muni.csv")

d05 <- read.csv("Dados/CasosMunicip/vivax05_muni.csv")

d06 <- read.csv("Dados/CasosMunicip/vivax06_muni.csv")

d07 <- read.csv("Dados/CasosMunicip/vivax07_muni.csv")

d08 <- read.csv("Dados/CasosMunicip/vivax08_muni.csv")

d09 <- read.csv("Dados/CasosMunicip/vivax09_muni.csv")

d10 <- read.csv("Dados/CasosMunicip/vivax10_muni.csv")

d11 <- read.csv("Dados/CasosMunicip/vivax11_muni.csv")

d12 <- read.csv("Dados/CasosMunicip/vivax12_muni.csv")

d13 <- read.csv("Dados/CasosMunicip/vivax13_muni.csv")

d14 <- read.csv("Dados/CasosMunicip/vivax14_muni.csv")

d15 <- read.csv("Dados/CasosMunicip/vivax15_muni.csv")

d16 <- read.csv("Dados/CasosMunicip/vivax16_muni.csv")

d17 <- read.csv("Dados/CasosMunicip/vivax17_muni.csv")

```

## Importanto os bancos de população
```{r setup, include=FALSE}
p03 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2003.csv", encoding = 'Latin-1')
#head(p03)
p03$YEAR <- 2003

p04 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2004.csv", encoding = 'Latin-1')
p04$YEAR <- 2004

p05 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2005.csv", encoding = 'Latin-1')
p05$YEAR <- 2005

p06 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2006.csv", encoding = 'Latin-1')
p06$YEAR <- 2006

p07 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2007.csv", encoding = 'Latin-1')
p07$YEAR <- 2007

p08 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2008.csv", encoding = 'Latin-1')
p08$YEAR <- 2008

p09 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2009.csv", encoding = 'Latin-1')
p09$YEAR <- 2009

p10 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2010.csv", encoding = 'UTF-8') #Feito no Linux
p10$YEAR <- 2010

p11<- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2011.csv", encoding = 'Latin-1')
p11$YEAR <- 2011

p12 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2012.csv", encoding = 'Latin-1')
p12$YEAR <- 2012

p13 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2013.csv", encoding = 'Latin-1')
p13$YEAR <- 2013

p14 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2014.csv", encoding = 'Latin-1')
p14$YEAR <- 2014

p15 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2015.csv", encoding = 'Latin-1')
p15$YEAR <- 2015

p16 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2016.csv", encoding = 'Latin-1')
p16$YEAR <- 2016

p17 <- fread("/home/raquel/Documentos/PosDoc_PROCC/OwncloudPD/malaria/AnalisesRaquel/Pasteur/Malaria_Mapping_TimeSeries_Data/pop2/pop2017.csv", encoding = 'Latin-1')
p17$YEAR <- 2017


pop_estimated <- rbind(p03, p04, p05, p06, p07, p08, p09, p10, p11, p12, p13, p14, p15, p16, p17)

write.csv(pop_estimated, file = "pop_estimated.csv", row.names = F)

```

## Merge dos dados de casos e população

Observações: Temos 5560 municípios no Brasil em 2003 e 579 com registro de malária no SIVEP. Farei o merge para manter os 5560 municípios. Aqueles que não tem registro, devem ter NA na informação sobre malária. Conferi e deu certo. Só consegui fazer o merge depois que mudei o nome da coluna de ligação que é o código do município. Tentei fazer atribuído as variáveis em cada banco mas não consegui.

- 2003  
10.41367% dos municípios com notificação de malária.  
Criei duas colunas para IPA, sendo IPA.na, uma coluna na qual NAs são substituidos por -99, pois para gerar os mapas, o NA não é aceito.
```{r}
#str(d03)
#str(p03)
names(p03)[1] <- "MUN_NOTI"
dp03 <- merge(p03, d03, all = T)

ptm03 <- 579/5560 * 100

summary(dp03$VIVAX)
hist(dp03$VIVAX, breaks = 40, col = 'red')
dp03[dp03$VIVAX >= 2000,]

dp03$IPA <- dp03$VIVAX/dp03$POP.EST * 1000
summary(dp03$IPA)
hist(dp03$IPA, breaks = 20, col = 'red')

nrow(dp03[dp03$IPA >= 50,])

high03 <- dp03[dp03$IPA > 100]
hhigh03 <- high03[order(high03$IPA, decreasing = T)]
hhigh03[1:20, ]  

hist(hhigh03$IPA, breaks = 10)

```

- 2004  
5564 municípios e 607 com registro de malária.  
10.90942% dos municípios com notificação de malária.
```{r}
#str(d04)
#str(p04)
names(p04)[1] <- "MUN_NOTI"
dp04 <- merge(p04, d04, all = T)
#head(dp04)
#dim(dp04)

ptm04 <- 607/5564 * 100

summary(dp04$VIVAX)
hist(dp04$VIVAX, breaks = 40, col = 'red')
dp04[dp04$VIVAX >= 2000,]

dp04$IPA <- dp04$VIVAX/dp04$POP.EST * 1000
summary(dp04$IPA)
hist(dp04$IPA, breaks = 20, col = 'red')
nrow(dp04[dp04$IPA >= 50,])
nrow(dp04[dp04$IPA >= 100,])

high04 <- dp04[dp04$IPA > 100]
hhigh04 <- high04[order(high04$IPA, decreasing = T)]
hhigh04[1:20, ]  

hist(hhigh04$IPA, breaks = 10)

```

- 2005    
5564 municípios e 609 com registro de malária.  
10.94536% dos municípios com notificação de malária.
```{r}
#str(d05)
#str(p05)
names(p05)[1] <- "MUN_NOTI"
dp05 <- merge(p05, d05, all = T)
#head(dp05)
#dim(dp05)

ptm05 <- 609/5564 * 100

summary(dp05$VIVAX)
hist(dp05$VIVAX, breaks = 40, col = 'red')
dp05[dp05$VIVAX >= 2000,]

dp05$IPA <- dp05$VIVAX/dp05$POP.EST * 1000
summary(dp05$IPA)
hist(dp05$IPA, breaks = 20, col = 'red')
nrow(dp05[dp05$IPA >= 50,])
nrow(dp05[dp05$IPA >= 100,])

high05 <- dp05[dp05$IPA > 100]
hhigh05 <- high05[order(high05$IPA, decreasing = T)]
hhigh05[1:20, ]  

hist(hhigh05$IPA, breaks = 12)

```

- 2006      
5564 municípios e 583 com registro de malária.  
10.47807% dos municípios com notificação de malária.
```{r}
#str(d06)
#str(p06)
names(p06)[1] <- "MUN_NOTI"
dp06 <- merge(p06, d06, all = T)
#head(dp06)
#dim(dp06)

ptm06 <- 583/5564 * 100

summary(dp06$VIVAX)
hist(dp06$VIVAX, breaks = 40, col = 'red')
dp06[dp06$VIVAX >= 2000,]

dp06$IPA <- dp06$VIVAX/dp06$POP.EST * 1000
summary(dp06$IPA)
hist(dp06$IPA, breaks = 20, col = 'red')
nrow(dp06[dp06$IPA >= 50,])
nrow(dp06[dp06$IPA >= 100,])

high06 <- dp06[dp06$IPA > 100]
hhigh06 <- high06[order(high06$IPA, decreasing = T)]
hhigh06[1:20, ]  

hist(hhigh06$IPA, breaks = 12)

```

- 2007        
5564 municípios e 567 com registro de malária.  
10.19051% dos municípios com notificação de malária.
```{r}
#str(d07)
#str(p07)
names(p07)[1] <- "MUN_NOTI"
dp07 <- merge(p07, d07, all = T)
#head(dp07)
#dim(dp07)

ptm07 <- 567/5564 * 100

summary(dp07$VIVAX)
hist(dp07$VIVAX, breaks = 40, col = 'red')
dp07[dp07$VIVAX >= 2000,]

dp07$IPA <- dp07$VIVAX/dp07$POP.EST * 1000
summary(dp07$IPA)
hist(dp07$IPA, breaks = 20, col = 'red')
nrow(dp07[dp07$IPA >= 100,])
nrow(dp07[dp07$IPA >= 50,])

high07 <- dp07[dp07$IPA > 100]
hhigh07 <- high07[order(high07$IPA, decreasing = T)]
hhigh07[1:20, ]  

hist(hhigh07$IPA, breaks = 12)

```

- 2008          
5565 municípios e 567 com registro de malária.
10.18868% dos municípios com notificação de malária.
```{r}
#str(d08)
#str(p08)
names(p08)[1] <- "MUN_NOTI"
dp08 <- merge(p08, d08, all = T)
#head(dp08)
#dim(dp08)

ptm08 <- 567/5565 * 100

summary(dp08$VIVAX)
hist(dp08$VIVAX, breaks = 40, col = 'red')
dp08[dp08$VIVAX >= 2000,]

dp08$IPA <- dp08$VIVAX/dp08$POP.EST * 1000
summary(dp08$IPA)
hist(dp08$IPA, breaks = 20, col = 'red')
nrow(dp08[dp08$IPA >= 50,])
nrow(dp08[dp08$IPA >= 100,])

high08 <- dp08[dp08$IPA > 100]
hhigh08 <- high08[order(high08$IPA, decreasing = T)]
hhigh08[1:20, ]  

hist(hhigh08$IPA, breaks = 14)

```

- 2009            
5565 municípios e 545 com registro de malária.
9.793351% dos municípios com notificação de malária.
```{r}
#str(d09)
#str(p09)
names(p09)[1] <- "MUN_NOTI"
dp09 <- merge(p09, d09, all = T)
#head(dp09)
#dim(dp09)

ptm09 <- 545/5565 * 100

summary(dp09$VIVAX)
hist(dp09$VIVAX, breaks = 40, col = 'red')
dp09[dp09$VIVAX >= 2000,]

dp09$IPA <- dp09$VIVAX/dp09$POP.EST * 1000
summary(dp09$IPA)
hist(dp09$IPA, breaks = 20, col = 'red')
nrow(dp09[dp09$IPA >= 50,])
nrow(dp09[dp09$IPA >= 100,])

high09 <- dp09[dp09$IPA > 100]
hhigh09 <- high09[order(high09$IPA, decreasing = T)]
hhigh09[1:20, ]  

hist(hhigh09$IPA, breaks = 12)

```

- 2010              
5565 municípios e 536 com registro de malária.
9.631626% dos municípios com notificação de malária.
```{r}
#str(d10)
#str(p10)
names(p10)[1] <- "MUN_NOTI"
dp10 <- merge(p10, d10, all = T)
#head(dp10)
#dim(dp10)

ptm10 <- 536/5565 * 100

summary(dp10$VIVAX)
hist(dp10$VIVAX, breaks = 40, col = 'red')
dp10[dp10$VIVAX >= 2000,]

dp10$IPA <- dp10$VIVAX/dp10$POP.EST * 1000
summary(dp10$IPA)
hist(dp10$IPA, breaks = 20, col = 'red')
nrow(dp10[dp10$IPA >= 50,])
nrow(dp10[dp10$IPA >= 100,])

high10 <- dp10[dp10$IPA > 100]
hhigh10 <- high10[order(high10$IPA, decreasing = T)]
hhigh10[1:20, ]  

hist(hhigh10$IPA, breaks = 12)

```

- 2011              
5565 municípios e 513 com registro de malária.
9.218329% dos municípios com notificação de malária.
```{r}
#str(d11)
#str(p11)
names(p11)[1] <- "MUN_NOTI"
dp11 <- merge(p11, d11, all = T)
#head(dp11)
#dim(dp11)

ptm11 <- 513/5565 * 100

summary(dp11$VIVAX)
hist(dp11$VIVAX, breaks = 40, col = 'red')
dp11[dp11$VIVAX >= 2000,]

dp11$IPA <- dp11$VIVAX/dp11$POP.EST * 1000
summary(dp11$IPA)
hist(dp11$IPA, breaks = 20, col = 'red')
nrow(dp11[dp11$IPA >= 50,])
nrow(dp11[dp11$IPA >= 100,])

high11 <- dp11[dp11$IPA > 100]
hhigh11 <- high11[order(high11$IPA, decreasing = T)]
hhigh11

hist(hhigh11$IPA, breaks = 11)

```

- 2012              
5565 municípios e 491 com registro de malária.
8.823001% dos municípios com notificação de malária.
```{r}
#str(d12)
#str(p12)
names(p12)[1] <- "MUN_NOTI"
dp12 <- merge(p12, d12, all = T)
#head(dp12)
#dim(dp12)

ptm12 <- 491/5565 * 100

summary(dp12$VIVAX)
hist(dp12$VIVAX, breaks = 40, col = 'red')
dp12[dp12$VIVAX >= 2000,]

dp12$IPA <- dp12$VIVAX/dp12$POP.EST * 1000
summary(dp12$IPA)
hist(dp12$IPA, breaks = 20, col = 'red')
nrow(dp12[dp12$IPA >= 50,])
nrow(dp12[dp12$IPA >= 100,])

high12 <- dp12[dp12$IPA > 100]
hhigh12 <- high12[order(high12$IPA, decreasing = T)]
hhigh12

hist(hhigh12$IPA, breaks = 10)

```

- 2013              
5570 municípios e 466 com registro de malária.
8.373765% dos municípios com notificação de malária.
```{r}
#str(d13)
#str(p13)
names(p13)[1] <- "MUN_NOTI"
dp13 <- merge(p13, d13, all = T)
#head(dp13)
#dim(dp13)

ptm13 <- 466/5565 * 100

summary(dp13$VIVAX)
hist(dp13$VIVAX, breaks = 40, col = 'red')
dp13[dp13$VIVAX >= 2000,]

dp13$IPA <- dp13$VIVAX/dp13$POP.EST * 1000
summary(dp13$IPA)
hist(dp13$IPA, breaks = 20, col = 'red')
nrow(dp13[dp13$IPA >= 50,])
nrow(dp13[dp13$IPA >= 100,])

high13 <- dp13[dp13$IPA > 100]
hhigh13 <- high13[order(high13$IPA, decreasing = T)]
hhigh13

hist(hhigh13$IPA, breaks = 10)

```

- 2014              
5570 municípios e 423 com registro de malária.
7.601078% dos municípios com notificação de malária.
```{r}
#str(d14)
#str(p14)
names(p14)[1] <- "MUN_NOTI"
dp14 <- merge(p14, d14, all = T)
#head(dp14)
#dim(dp14)

ptm14 <- 423/5565 * 100

summary(dp14$VIVAX)
hist(dp14$VIVAX, breaks = 40, col = 'red')
dp14[dp14$VIVAX >= 2000,]

dp14$IPA <- dp14$VIVAX/dp14$POP.EST * 1000
summary(dp14$IPA)
hist(dp14$IPA, breaks = 20, col = 'red')
nrow(dp14[dp14$IPA >= 50,])
nrow(dp14[dp14$IPA >= 100,])

high14 <- dp14[dp14$IPA > 100]
hhigh14 <- high14[order(high14$IPA, decreasing = T)]
hhigh14

hist(hhigh14$IPA, breaks = 10)
D
```

- 2015              
5570 municípios e 390 com registro de malária.
7.601078% dos municípios com notificação de malária.
```{r}
#str(d15)
#str(p15)
names(p15)[1] <- "MUN_NOTI"
dp15 <- merge(p15, d15, all = T)
#head(dp15)
#dim(dp15)

ptm15 <- 423/5565 * 100

summary(dp15$VIVAX)
hist(dp15$VIVAX, breaks = 40, col = 'red')
dp15[dp15$VIVAX >= 2000,]

dp15$IPA <- dp15$VIVAX/dp15$POP.EST * 1000
summary(dp15$IPA)
hist(dp15$IPA, breaks = 20, col = 'red')
nrow(dp15[dp15$IPA >= 50,])
nrow(dp15[dp15$IPA >= 100,])

high15 <- dp15[dp15$IPA > 100]
hhigh15 <- high15[order(high15$IPA, decreasing = T)]
hhigh15

hist(hhigh15$IPA, breaks = 12)

```

- 2016              
5570 municípios e 386 com registro de malária.
7.601078% dos municípios com notificação de malária.
```{r}
#str(d16)
#str(p16)
names(p16)[1] <- "MUN_NOTI"
dp16 <- merge(p16, d16, all = T)
#head(dp16)
#dim(dp16)

ptm16 <- 423/5565 * 100

summary(dp16$VIVAX)
hist(dp16$VIVAX, breaks = 40, col = 'red')
dp16[dp16$VIVAX >= 2000,]

dp16$IPA <- dp16$VIVAX/dp16$POP.EST * 1000
summary(dp16$IPA)
hist(dp16$IPA, breaks = 20, col = 'red')
nrow(dp16[dp16$IPA >= 50,])
nrow(dp16[dp16$IPA >= 100,])
dp16[dp16$IPA >= 100,] 

high16 <- dp16[dp16$IPA > 100]
hhigh16 <- high16[order(high16$IPA, decreasing = T)]
hhigh16

hist(hhigh16$IPA, breaks = 10)

```

- 2017              
5570 municípios e 407 com registro de malária.
7.313567% dos municípios com notificação de malária.
```{r}
#str(d17)
#str(p17)
names(p17)[1] <- "MUN_NOTI"
dp17 <- merge(p17, d17, all = T)
#head(dp17)
#dim(dp17)

ptm17 <- 407/5565 * 100

summary(dp17$VIVAX)
hist(dp17$VIVAX, breaks = 40, col = 'red')
dp17[dp17$VIVAX >= 2000,]

dp17$IPA <- dp17$VIVAX/dp17$POP.EST * 1000
summary(dp17$IPA)
hist(dp17$IPA, breaks = 20, col = 'red')
nrow(dp17[dp17$IPA >= 50,])
nrow(dp17[dp17$IPA >= 100,])

high17 <- dp17[dp17$IPA > 100]
hhigh17 <- high17[order(high17$IPA, decreasing = T)]
hhigh17

hist(hhigh17$IPA, breaks = 10)

```

Montando uma tabela de casos, população e IPA com todos os anos 
```{r}
dp03$ANO <- 2003
dp04$ANO <- 2004
dp05$ANO <- 2005
dp06$ANO <- 2006
dp07$ANO <- 2007
dp08$ANO <- 2008
dp09$ANO <- 2009
dp10$ANO <- 2010
dp11$ANO <- 2011
dp12$ANO <- 2012 
dp13$ANO <- 2013
dp14$ANO <- 2014
dp15$ANO <- 2015
dp16$ANO <- 2016
dp17$ANO <- 2017

junta <- rbind(dp03, dp04, dp05, dp06, dp07, dp08, dp09, dp10, dp11, dp12, dp13, dp14, dp15, dp16, dp17)

#write.csv(junta, file = "IPA_ALegal.csv", row.names = F)

```


# Mapa por município
```{r}
mapa <- readOGR("shape/", layer="BRMUE250GC_SIR")
plot(mapa)
mapa@data
head(mapa@data)
mapa@data$geocodigo6 <- str_sub(mapa@data$CD_GEOCMU, 1, 6)

```

## Query map  
Para fazer um query do mapa e manter somente a Amazônia Legal, vou fazer um merge com a tabela com código da UF para facilitar o recorte do mapa. Vou usar uma das tabelas mais recentes de população para isso, antes vou limpar as colunas e deixar só o necessário. O mapa tem 5572 polígonos, além do que realmente temos registrado no IBGE que são 5570.   
```{r}
pop <- p17
pop <- pop[,-c(4:6)]
names(pop)[1] <- "geocodigo6"
mapa@data <- merge(mapa@data, pop)
length(unique(mapa@data$geocodigo6))
head(mapa@data)# geocodigo6, NM_MUNICIP, CD_GEOCMU, UF, COD.UF

#REFAZER
mapaAL <- mapa[{mapa@data$COD.UF == 11}|{mapa@data$COD.UF == 12}|{mapa@data$COD.UF == 13}|{mapa@data$COD.UF == 14}|{mapa@data$COD.UF == 15}|
{mapa@data$COD.UF == 16}|{mapa@data$COD.UF == 17}|{mapa@data$COD.UF == 21}|{mapa@data$COD.UF == 51},] 

length(unique(mapaAL@data$geocodigo6))
#808 municípios da AL.

```


## Mapas IPA

Testei primeiro com o ano de 2003.    

Precisei transformar os NAs do IPA em um número improvável para esse caso, -99, pois a função para o mapa não aceita NA.   

Fiz um recorte no mapa e considerei somente os estados da Amazônia Legal, pois estava ficando muito pesado. Mas talvez agora que tudo "praticamente" se resolveu, valha a pena voltar o mapa todo?  

Tem alguns municípios que ficam sempre em branco, não consegui descobrir o porquê. Alguns municípios não tem registro nenhum de malária, esses estão como "-99" no IPA.na. Colori "-99"" de verde para visualizar melhor (posso mudar a cor, não fica muito bonito, foi mais para visualizar) e esses mesmos municípios continuam brancos. Então eles não são nem iguais a zero e nem "-99". Quando peço para contar os municípios com valores menores ou iguais a zero ou iguais a "-99"", sai o mesmo valor, 226. Há uma mudança na quantidade de municípios ao longo dos anos. Esse shape é do último censo, então pode haver diferença se pensarmos em 2003. Não tem nenhum IPA exatamente == 0. 

Precisei começar de trás para frente, ou seja, dos anos mais recentes. Assim consegui incluir os IPAs de todos os anos no mesmo mapa sem ter problemas. No entanto, começamos com 808 municípios e terminamos com 753. Isso devido as diferenças que existem na quantidade de municípios ao longo dos anos. Se quiser manter os 756, aí temos que ver como fazer, não consegui. Para não ter mais problemas na hora do merge, limpei as tabelas e deixei apenas o código do município para fazer a ligação e o IPA.
 
Não consegui ver quais os 3 municípios que somem no merge anterior, se isso se repete nos outros anos. De 2017-2013, os 756 se mantem. De 2012-2004, são 755 e depois em 2003, 753.

- Parâmetros gráficos
```{r}
#Cores
c1 <- "blue"
c2 <- "green"
c3 <- "yellow"
c4 <- "red"
c5 <- "brown"

#Titulo
t1 <- 0.4

#Legenda
t2 <- 0.8
```

- 2017    
Aqui se mantiveram os 808.
```{r}
dp17$IPA17.na <- dp17$IPA
dp17[which(is.na(dp17$IPA17.na)),]$IPA17.na <- -99
nrow(dp17[which(dp17$IPA17.na == -99),])
dpp17 <- dp17[,-c(2:9)]
names(dpp17)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp17)


par(mar = c(2,1,1,1))
plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA17.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA17.na > 0 & mapaAL@data$IPA17.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA17.na > 10 & mapaAL@data$IPA17.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA17.na >= 50,], col = c4, add = T) 
title("API 2017", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2016  
Aqui se mantiveram os 808.
```{r}
dp16$IPA16.na <- dp16$IPA
dp16[which(is.na(dp16$IPA16.na)),]$IPA16.na <- -99
nrow(dp16[which(dp16$IPA16.na == -99),])
dpp16 <- dp16[,-c(2:9)]
names(dpp16)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp16)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA16.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA16.na > 0 & mapaAL@data$IPA16.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA16.na > 10 & mapaAL@data$IPA16.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA16.na >= 50,], col = c4, add = T) 
title("API 2016", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2015  
Aqui se mantiveram os 808.
```{r}
dp15$IPA15.na <- dp15$IPA
dp15[which(is.na(dp15$IPA15.na)),]$IPA15.na <- -99
nrow(dp15[which(dp15$IPA15.na == -99),])
dpp15 <- dp15[,-c(2:9)]
names(dpp15)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp15)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA15.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA15.na > 0 & mapaAL@data$IPA15.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA15.na > 10 & mapaAL@data$IPA15.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA15.na >= 50,], col = c4, add = T) 
title("API 2015", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2014    
Aqui se mantiveram os 808.
```{r}
dp14$IPA14.na <- dp14$IPA
dp14[which(is.na(dp14$IPA14.na)),]$IPA14.na <- -99
nrow(dp14[which(dp14$IPA14.na == -99),])
dpp14 <- dp14[,-c(2:9)]
names(dpp14)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp14)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA14.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA14.na > 0 & mapaAL@data$IPA14.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA14.na > 10 & mapaAL@data$IPA14.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA14.na >= 50,], col = c4, add = T) 
title("API 2014", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2013    
Aqui se mantiveram os 808.
```{r}
dp13$IPA13.na <- dp13$IPA
dp13[which(is.na(dp13$IPA13.na)),]$IPA13.na <- -99
nrow(dp13[which(dp13$IPA13.na == -99),])
dpp13 <- dp13[,-c(2:9)]
names(dpp13)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp13)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA13.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA13.na > 0 & mapaAL@data$IPA13.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA13.na > 10 & mapaAL@data$IPA13.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA13.na >= 50,], col = c4, add = T) 
title("API 2013", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2012  
Aqui mudou para 807.  
```{r}
dp12$IPA12.na <- dp12$IPA
dp12[which(is.na(dp12$IPA12.na)),]$IPA12.na <- -99
nrow(dp12[which(dp12$IPA12.na == -99),])
dpp12 <- dp12[,-c(2:9)]
names(dpp12)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp12)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA12.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA12.na > 0 & mapaAL@data$IPA12.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA12.na > 10 & mapaAL@data$IPA12.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA12.na >= 50,], col = c4, add = T) 
title("API 2012", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2011  
807.
```{r}
dp11$IPA11.na <- dp11$IPA
dp11[which(is.na(dp11$IPA11.na)),]$IPA11.na <- -99
nrow(dp11[which(dp11$IPA11.na == -99),])
dpp11 <- dp11[,-c(2:9)]
names(dpp11)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp11)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA11.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA11.na > 0 & mapaAL@data$IPA11.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA11.na > 10 & mapaAL@data$IPA11.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA11.na >= 50,], col = c4, add = T) 
title("API 2011", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2010  
807. 
```{r}
dp10$IPA10.na <- dp10$IPA
dp10[which(is.na(dp10$IPA10.na)),]$IPA10.na <- -99
nrow(dp10[which(dp10$IPA10.na == -99),])
dpp10 <- dp10[,-c(2:9)]
names(dpp10)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp10)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA10.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA10.na > 0 & mapaAL@data$IPA10.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA10.na > 10 & mapaAL@data$IPA10.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA10.na >= 50,], col = c4, add = T) 
title("API 2010", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2009  
807. 
```{r}
dp09$IPA09.na <- dp09$IPA
dp09[which(is.na(dp09$IPA09.na)),]$IPA09.na <- -99
nrow(dp09[which(dp09$IPA09.na == -99),])
dpp09 <- dp09[,-c(2:9)]
names(dpp09)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp09)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA09.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA09.na > 0 & mapaAL@data$IPA09.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA09.na > 10 & mapaAL@data$IPA09.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA09.na >= 50,], col = c4, add = T) 
title("API 2009", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2008  
807. 
```{r}
dp08$IPA08.na <- dp08$IPA
dp08[which(is.na(dp08$IPA08.na)),]$IPA08.na <- -99
nrow(dp08[which(dp08$IPA08.na == -99),])
dpp08 <- dp08[,-c(2:9)]
names(dpp08)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp08)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA08.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA08.na > 0 & mapaAL@data$IPA08.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA08.na > 10 & mapaAL@data$IPA08.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA08.na >= 50,], col = c4, add = T) 
title("API 2008", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2007  
807. 
```{r}
dp07$IPA07.na <- dp07$IPA
dp07[which(is.na(dp07$IPA07.na)),]$IPA07.na <- -99
nrow(dp07[which(dp07$IPA07.na == -99),])
dpp07 <- dp07[,-c(2:9)]
names(dpp07)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp07)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA07.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA07.na > 0 & mapaAL@data$IPA07.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA07.na > 10 & mapaAL@data$IPA07.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA07.na >= 50,], col = c4, add = T) 
title("API 2007", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2006  
807. 
```{r}
dp06$IPA06.na <- dp06$IPA
dp06[which(is.na(dp06$IPA06.na)),]$IPA06.na <- -99
nrow(dp06[which(dp06$IPA06.na == -99),])
dpp06 <- dp06[,-c(2:9)]
names(dpp06)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp06)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA06.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA06.na > 0 & mapaAL@data$IPA06.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA06.na > 10 & mapaAL@data$IPA06.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA06.na >= 50,], col = c4, add = T) 
title("API 2006", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2005  
807. 
```{r}
dp05$IPA05.na <- dp05$IPA
dp05[which(is.na(dp05$IPA05.na)),]$IPA05.na <- -99
nrow(dp05[which(dp05$IPA05.na == -99),])
dpp05 <- dp05[,-c(2:9)]
names(dpp05)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp05)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA05.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA05.na > 0 & mapaAL@data$IPA05.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA05.na > 10 & mapaAL@data$IPA05.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA05.na >= 50,], col = c4, add = T) 
title("API 2005", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2004  
807. 
```{r}
dp04$IPA04.na <- dp04$IPA
dp04[which(is.na(dp04$IPA04.na)),]$IPA04.na <- -99
nrow(dp04[which(dp04$IPA04.na == -99),])
dpp04 <- dp04[,-c(2:9)]
names(dpp04)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp04)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA04.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA04.na > 0 & mapaAL@data$IPA04.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA04.na > 10 & mapaAL@data$IPA04.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA04.na >= 50,], col = c4, add = T) 
title("API 2004", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")
```

- 2003  
805. 
```{r}
dp03$IPA03.na <- dp03$IPA
dp03[which(is.na(dp03$IPA03.na)),]$IPA03.na <- -99
nrow(dp03[which(dp03$IPA03.na == -99),])
dpp03 <- dp03[,-c(2:9)]
names(dpp03)[1] <- "geocodigo6"
mapaAL@data <- merge(mapaAL@data, dpp03)

plot(mapaAL)
plot(mapaAL[mapaAL@data$IPA03.na == -99,], col = c1, add = T)
plot(mapaAL[mapaAL@data$IPA03.na > 0 & mapaAL@data$IPA03.na <= 10,], col = c2, add = T) 
plot(mapaAL[mapaAL@data$IPA03.na > 10 & mapaAL@data$IPA03.na < 50,], col = c3, add = T) 
plot(mapaAL[mapaAL@data$IPA03.na >= 50,], col = c4, add = T) 
title("API 2003", cex = t1)
legend("bottomleft", fill = c(c1, c2, c3, c4), c("0", "(0, 10]","(10, 50]", "> 50"), bty = "n", cex = t2, title = "API")

```

